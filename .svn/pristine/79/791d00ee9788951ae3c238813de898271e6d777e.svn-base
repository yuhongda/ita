$(function(){$("#phone").focus();refreshList(false);$("#go").click(function(e){e.preventDefault();var json=Game.GetJSON().value;var users=JSON.parse(json);var items=["guomao","guibinlou"];var phone=$.trim($("#phone").val());var flag=true;var admin="13910681651";if(phone.length==0||!(/^(13[0-9]|15[0-9]|18[0-9])\d{8}$/.test(phone))){flag=false;alert("\u624b\u673a\u53f7\u4e0d\u6b63\u786e\uff01");return}else{if(phone==admin){refreshList(true);return}var errcode=checkuser(phone,users);if(errcode==1){alert("\u975e\u5e38\u62b1\u6b49\uff0c\u60a8\u8f93\u5165\u7684\u624b\u673a\u53f7\u7801\u5df2\u7ecf\u53c2\u52a0\u8fc7\u8fd9\u6b21\u6d3b\u52a8\u4e86");flag=false;return}else{if(errcode==2){alert("\u975e\u5e38\u62b1\u6b49\uff0c\u60a8\u8f93\u5165\u7684\u624b\u673a\u53f7\u7801\u4e0d\u5728\u6b64\u6b21\u6d3b\u52a8\u7684\u7528\u6237\u8303\u56f4\u91cc");flag=false;return}}}if(flag){var i=randomXToY(0,1);var result=gethotel(i,users);$.each(users,function(key,value){if(users[key].phone==phone){users[key].hotel=result}});var jsonString=JSON.stringify(users);var o=JSON.parse(jsonString);eval("var jsonString = '"+JSON.stringify(o)+"';");if(Game.Save(jsonString.toString())){$("#choosing").fadeIn(function(){var _this=$(this);setTimeout(function(){_this.hide().css({background:"url(images/game/"+items[result]+".png) top left no-repeat",_background:"url(images/game/"+items[result]+".gif) top left no-repeat"}).fadeIn();weibo("\u6211\u5728\u5927\u4f17\u6c7d\u8f66\u9152\u5e97\u62bd\u53d6\u6d3b\u52a8\u4e2d\u62bd\u5230\u4e86"+((result==0)?"\u56fd\u8d38\u5927\u53a6":"\u8d35\u5bbe\u697c")+"!  \u8be6\u60c5\u89c1\uff1a");refreshList(false);setTimeout(function(){window.location.reload()},10000)},5000)})}else{alert("\u62bd\u53d6\u5931\u8d25\u3002\u8bf7\u91cd\u8bd5...")}}});$("#phone").keydown(function(e){if(e.which==13){e.preventDefault();$(this).blur();$("#go").click()}})});function refreshList(a){var b=Game.GetJSON().value;var d=JSON.parse(b);var c=$('<table class="table"></table>');$.each(d,function(e,f){if(d[e].hotel!="none"){if(!a){c.append('<tr><td style="width:110px; text-align:center;">'+(a?d[e].phone:encodePhone(d[e].phone))+"</td><td>\u62bd\u4e2d"+(d[e].hotel==0?"\u56fd\u8d38\u5927\u53a6":"\u8d35\u5bbe\u697c")+"</td></tr>")}else{c.append('<tr><td colspan="2">'+d[e].name+'</td></tr><tr><td style="width:110px; text-align:center;">'+(a?d[e].phone:encodePhone(d[e].phone))+"</td><td>\u62bd\u4e2d"+(d[e].hotel==0?"\u56fd\u8d38\u5927\u53a6":"\u8d35\u5bbe\u697c")+"</td></tr>")}}});$("#list").hide().empty().append(c).fadeIn()}function encodePhone(a){return a.substring(0,3)+"****"+a.substring(7,a.length)}function gethotel(b,c){var a=0;$.each(c,function(d,e){if(c[d].hotel!="none"&&parseInt(c[d].hotel)==b){a++}});if(b==0&&a>=6){return 1}else{if(b==1&&a>=12){return 0}else{return b}}}function randomXToY(b,d,a){var c=b+(Math.random()*(d-b));return typeof a=="undefined"?Math.round(c):c.toFixed(a)}function checkuser(a,c){var b=2;$.each(c,function(d,e){if(c[d].phone==a){if(c[d].hotel=="none"){b=0}else{b=1}}});return b}function weibo(f){var b=142,d=32;var e={url:location.href,type:"4",count:"",appkey:"",title:f,pic:"",ralateUid:"",language:"zh_cn",rnd:new Date().valueOf()};var a=[];for(var c in e){a.push(c+"="+encodeURIComponent(e[c]||""))}$("#choosing").append($('<iframe id="weibo" allowTransparency="true" frameborder="0" scrolling="no" src="http://hits.sinajs.cn/A1/weiboshare.html?'+a.join("&")+'" width="'+b+'" height="'+d+'"></iframe>'))};
